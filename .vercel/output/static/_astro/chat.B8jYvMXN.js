import{v as H,w as ie}from"./runtime-dom.esm-bundler.CkxCeCJQ.js";import{c as p,i as ee,a as te,h as G,m as N}from"./wagmiConfig.Chk1Y_fx.js";import{_ as $}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{g as q,w as F,r as I,c as D}from"./watchConnections.CEVD3vQ5.js";import{g as j}from"./getAccount.CrAKNmNJ.js";import{d as Q}from"./disconnect.fQnpZ0pp.js";import{r as l,o as V,k as ne,j as Y,a as B,c as k,d as r,t as E,F as ce,e as le,w as Z,s as R,h as se,q as U,n as de}from"./runtime-core.esm-bundler.C8n-v3-D.js";import{s as ue}from"./signMessage.bXjFpeGI.js";import{w as re,c as X,p as J,g as oe,a as ae,L as T,l as L,s as z}from"./getEthersSigner.DIrFHjWe.js";import{g as ye}from"./getConnectorClient.CvN7nnx2.js";import"./inherits_browser.BGXtg88A.js";async function pe(h,s={}){const i=await ye(h,s);return i.extend(re),i.extend(re)}const ge={__name:"ConnectWallet",setup(h,{expose:s}){s();const i=l(),e=l(),d=async()=>{try{let o=await j(p);o&&(e.value=o.address)}catch{}};let y;V(async()=>{i.value=q(p),y=F(p,{onChange(o){let m=j(p);console.log(m),e.value=m.address}}),await I(p),await d()}),ne(()=>{y()});const n=async o=>{await D(p,{connector:o})},w=Y(()=>i.value?.length>0?i.value.filter(o=>o.id!=="injected"):[]),f={connectors:i,address:e,checkAccount:d,get unwatch(){return y},set unwatch(o){y=o},selectConnector:n,filteredConnector:w,createCBWallet:async()=>{const o=i.value.find(m=>m.id==="coinbaseWalletSDK");o&&await D(p,{connector:o})},connectWallet:async()=>{try{await D(p,{connector:ee()})}catch{}await d()},disconnectWallet:async()=>{try{await Q(p)}catch{}await d()},computed:Y,onMounted:V,onUnmounted:ne,ref:l,get connect(){return D},get reconnect(){return I},get getAccount(){return j},get disconnect(){return Q},get getConnectors(){return q},get watchConnections(){return F},get config(){return p},get injected(){return ee}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},fe=["onClick"];function me(h,s,i,e,d,y){return B(),k("div",null,[r("p",null,"address: "+E(e.address),1),(B(!0),k(ce,null,le(e.filteredConnector,n=>(B(),k("div",null,[r("button",{onClick:w=>e.selectConnector(n),class:"border p-2 rounded-xl"},E(n.name),9,fe)]))),256)),r("button",{onClick:s[0]||(s[0]=n=>e.createCBWallet())},"Create Wallet"),r("button",{onClick:s[1]||(s[1]=n=>e.disconnectWallet())},"Disconnect Wallet")])}const ve=$(ge,[["render",me]]),we={__name:"ConnectProxyWallet",emits:["init"],setup(h,{expose:s,emit:i}){s();const e=l(),d=l(),y=i,M={proxyAddress:e,password:d,emit:y,connectCoinbase:async()=>{try{await D(p,{connector:te({appName:"Ruilabs",preference:"smartWalletOnly"})})}catch(g){console.log(g)}},restoreProxyWallet:async()=>{const g=localStorage.getItem("proxyAccount"),{ciphertext:f,iv:o,salt:m}=JSON.parse(g);console.log(f,o,m);const S=async(b,P)=>{const C=new TextEncoder,t=await crypto.subtle.importKey("raw",C.encode(b),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:P,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])},W=await(async(b,P,C,t)=>{const a=Buffer.from(b,"base64"),c=Buffer.from(C,"base64"),u=Buffer.from(t,"base64"),K=await S(P,u),O=await crypto.subtle.decrypt({name:"AES-GCM",iv:c},K,a);return new TextDecoder().decode(O)})(f,d.value,o,m),x=J(W),v=X({account:x,chain:N,transport:G()});e.value=v.account.address,y("init",v)},generateProxyWallet:async()=>{const g=oe(),f=async(W,x)=>{const v=new TextEncoder,b=await crypto.subtle.importKey("raw",v.encode(W),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:x,iterations:1e5,hash:"SHA-256"},b,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])},m=await(async(W,x)=>{const v=crypto.getRandomValues(new Uint8Array(16)),b=await f(x,v),P=crypto.getRandomValues(new Uint8Array(12)),C=new TextEncoder().encode(W),t=await crypto.subtle.encrypt({name:"AES-GCM",iv:P},b,C);return{ciphertext:Buffer.from(t).toString("base64"),iv:Buffer.from(P).toString("base64"),salt:Buffer.from(v).toString("base64")}})(g,d.value);localStorage.setItem("proxyAccount",JSON.stringify(m));const S=J(g),A=X({account:S,chain:N,transport:G()});console.log(A),e.value=A.account.address,y("init",A)},ref:l,get signMessage(){return ue},get connect(){return D},get reconnect(){return I},get getAccount(){return j},get disconnect(){return Q},get getConnectors(){return q},get watchConnections(){return F},get config(){return p},get coinbaseWallet(){return te},get createWalletClient(){return X},get http(){return G},get privateKeyToAccount(){return J},get generatePrivateKey(){return oe},get mainnet(){return N}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}};function xe(h,s,i,e,d,y){return B(),k("div",null,[r("p",null,"Proxy: "+E(e.proxyAddress),1),r("button",{class:"border p-2 px-4 rounded-xl",onClick:s[0]||(s[0]=n=>e.connectCoinbase())},"Connect Coinbase"),r("form",null,[Z(r("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.password=n),type:"password",placeholder:"enter your password"},null,512),[[H,e.password]])]),r("button",{onClick:s[2]||(s[2]=n=>e.generateProxyWallet())},"Generate new proxy"),r("button",{onClick:s[3]||(s[3]=n=>e.restoreProxyWallet())},"Restore")])}const _e=$(we,[["render",xe]]),be={__name:"chat",setup(h,{expose:s}){s();const i=l(),e=l(),d=l("0xCaFE1246df2B91336A87b655247Bd91086632518"),y=l(),n=l(),w=l(),_=l(),M=l(!0),g=l("Initializing..."),f=l(!1),o=l(),m=async()=>{(await j(p)).address!=null?await A():(w.value=[],_.value=[],g.value="Please connect your wallet")};V(async()=>{});const S=async()=>{console.log("getting signer");let t=!1;try{t=await ae(p),console.log(t);let a=await t.provider.getSigner();console.log(a),t=a}catch(a){console.log(a)}if(t)return t;setTimeout(async()=>{await S()},1e3)},A=async()=>{g.value="Initializing xmtp...";let t=await S();console.log(t.address),i.value=t?.address;const a={env:"production",disablePersistenceEncryption:!0};let c=t.address,u=!1;try{u=L(c),await fetch("/api/keys.json",{method:"POST",body:JSON.stringify({address:c,keys:Buffer.from(u).toString("binary")})})}catch(O){console.log(O)}u||(console.log("getting keys"),u=await T.getKeys(t,{...a}),console.log(u),z(c,u));const K=await T.create(null,{...a,privateKeyOverride:u});n.value=U(K)};R(n,async()=>{if(n.value){w.value=await n.value.conversations.list();let t=w.value.find(a=>a.peerAddress===d.value);console.log(t),t||(await n.value.conversations.newConversation(d.value),await x()),await x()}});const W=async()=>{f.value=!0;let t=y.value;y.value=void 0;try{let c=await(await n.value.conversations.newConversation(d.value)).send(t);console.log(c)}catch{}f.value=!1},x=async()=>{g.value="Loading conversation...",_.value=[];let t=w.value.find(a=>a.peerAddress===d.value);if(t){let a=await t.messages();console.log(a),_.value=a.map(c=>({content:c.content,id:c.id,senderAddress:c.senderAddress})),g.value="All Good!",M.value=!1,v();for await(const c of await t.streamMessages())_.value.find(K=>K.id===c.id)||_.value.push({content:c.content,id:c.id,senderAddress:c.senderAddress}),v()}};R(w,async()=>{await x()});const v=()=>{o?.value&&o.value.scrollIntoView({behavior:"smooth"})},C={address:i,proxiedAddress:e,recipientAddress:d,message:y,xmtpClient:n,conversations:w,messages:_,busy:M,statusText:g,sendBusy:f,spacer:o,tryInitXmtp:m,getSigner:S,initXmtp:A,sendMessage:W,fetchMessages:x,scrollToBottom:v,getDirection:t=>t.senderAddress===i.value||t.senderAddress===e.value?"justify-end text-right":"justify-start text-left",initXmtpProxy:async t=>{const a={env:"production",disablePersistenceEncryption:!0};let c=t.account.address;e.value=c;let u=!1;try{u=L(c)}catch(O){console.log(O)}u||(console.log("getting keys"),u=await T.getKeys(t,{...a}),console.log(u),z(c,u));const K=await T.create(null,{...a,privateKeyOverride:u});n.value=U(K)},computed:Y,markRaw:U,onMounted:V,ref:l,watch:R,ConnectWallet:ve,ConnectProxyWallet:_e,get getEthersSigner(){return ae},get Client(){return T},get loadKeys(){return L},get storeKeys(){return z},get reconnect(){return I},get getAccount(){return j},get watchConnections(){return F},get config(){return p},get getWalletClient(){return pe}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},Ce={class:"w-full flex justify-center items-center mb-4"},he={class:"w-full max-w-sm"},Se=r("p",null,"Receipient:",-1),Ae={class:"w-full flex justify-center items-center flex-col"},We={class:"w-full max-w-sm border rounded-xl p-4 h-[500px] overflow-y-auto"},Pe={class:"space-y-1"},Ke={class:"max-w-[40%] border rounded-md p-1 px-2"},Be={ref:"spacer",class:"w-full h-1"},ke=["disabled"],Me={class:"flex justify-center items-center w-full pr-2"},De=["disabled"];function je(h,s,i,e,d,y){return B(),k("div",null,[se(e.ConnectWallet),se(e.ConnectProxyWallet,{onInit:e.initXmtpProxy}),r("p",null,E(e.busy),1),r("p",null,E(e.statusText),1),r("div",Ce,[r("div",he,[Se,Z(r("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.recipientAddress=n),class:"border rounded-xl w-full p-4",placeholder:"enter recipient address",type:"text"},null,512),[[H,e.recipientAddress]])])]),r("div",Ae,[r("div",We,[r("div",Pe,[(B(!0),k(ce,null,le(e.messages,n=>(B(),k("div",{class:de([e.getDirection(n),"w-full flex"])},[r("div",Ke,E(n.content),1)],2))),256))]),r("div",Be,null,512)]),r("form",{onSubmit:s[2]||(s[2]=ie(n=>e.sendMessage(),["prevent"])),class:"w-full max-w-sm border rounded-xl grid grid-cols-6 mt-2 gap-2"},[Z(r("input",{disabled:e.sendBusy,"onUpdate:modelValue":s[1]||(s[1]=n=>e.message=n),class:"col-span-5 p-4 rounded-xl",placeholder:"enter message",type:"text"},null,8,ke),[[H,e.message]]),r("div",Me,[r("button",{disabled:e.sendBusy,type:"submit",class:"rounded-xl border p-1 px-2"},"Send",8,De)])],32)])])}const Je=$(be,[["render",je]]);export{Je as default};
